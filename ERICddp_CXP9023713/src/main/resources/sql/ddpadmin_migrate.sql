-- END DDP-2.0.4295
-- END DDP-2.0.4296

ALTER TABLE db_replicas
 ADD COLUMN cert VARCHAR(64);

-- END DDP-2.0.4297
-- END DDP-2.0.4298
-- END DDP-2.0.4299
-- END DDP-2.0.4300
-- END DDP-2.0.4301
-- END DDP-2.0.4302
-- END DDP-2.0.4303
-- END DDP-2.0.4304
-- END DDP-2.0.4305

CREATE TABLE repl_delay (
  time DATETIME NOT NULL,
  replica VARCHAR(64) NOT NULL,
  delay MEDIUMINT UNSIGNED NOT NULL,
  INDEX timeIdx(time)
) PARTITION BY RANGE ( TO_DAYS(time) )
(
  PARTITION QMAXVALUE VALUES LESS THAN MAXVALUE
);
-- END DDP-2.0.4306
-- END DDP-2.0.4307
-- END DDP-2.0.4308
-- END DDP-2.0.4309
-- END DDP-2.0.4310
-- END DDP-2.0.4311
-- END DDP-2.0.4312
-- END DDP-2.0.4313
-- END DDP-2.0.4314
-- END DDP-2.0.4315
-- END DDP-2.0.4316
-- END DDP-2.0.4317
-- END DDP-2.0.4318
-- END DDP-2.0.4319
-- END DDP-2.0.4320
-- END DDP-2.0.4321
-- END DDP-2.0.4322
-- END DDP-2.0.4323
-- END DDP-2.0.4324
-- END DDP-2.0.4325
-- END DDP-2.0.4326
-- END DDP-2.0.4327
-- END DDP-2.0.4328
-- END DDP-2.0.4329
-- END DDP-2.0.4330
-- END DDP-2.0.4331
-- END DDP-2.0.4332
-- END DDP-2.0.4333
-- END DDP-2.0.4334
-- END DDP-2.0.4335

TRUNCATE TABLE repl_delay;

-- END DDP-2.0.4336
-- END DDP-2.0.4337
-- END DDP-2.0.4338
-- END DDP-2.0.4339
-- END DDP-2.0.4340
-- END DDP-2.0.4341
-- END DDP-2.0.4342
-- END DDP-2.0.4343
-- END DDP-2.0.4344
-- END DDP-2.0.4345
-- END DDP-2.0.4346
-- END DDP-2.0.4347
-- END DDP-2.0.4348
-- END DDP-2.0.4349
-- END DDP-2.0.4350
-- END DDP-2.0.4351
-- END DDP-2.0.4352
-- END DDP-2.0.4353
-- END DDP-2.0.4354
-- END DDP-2.0.4355
-- END DDP-2.0.4356
-- END DDP-2.0.4357
-- END DDP-2.0.4358
-- END DDP-2.0.4359
-- END DDP-2.0.4360
-- END DDP-2.0.4361
-- END DDP-2.0.4362
-- END DDP-2.0.4363
-- END DDP-2.0.4364
-- END DDP-2.0.4365
-- END DDP-2.0.4366
-- END DDP-2.0.4367
-- END DDP-2.0.4368
-- END DDP-2.0.4369
-- END DDP-2.0.4370
-- END DDP-2.0.4371
-- END DDP-2.0.4372
-- END DDP-2.0.4373
-- END DDP-2.0.4374
-- END DDP-2.0.4375
-- END DDP-2.0.4376
-- END DDP-2.0.4377
-- END DDP-2.0.4378
-- END DDP-2.0.4379
-- END DDP-2.0.4380
-- END DDP-2.0.4381
-- END DDP-2.0.4382
-- END DDP-2.0.4383
-- END DDP-2.0.4384
-- END DDP-2.0.4385
-- END DDP-2.0.4386
-- END DDP-2.0.4387
-- END DDP-2.0.4388
-- END DDP-2.0.4389
-- END DDP-2.0.4390
-- END DDP-2.0.4391
-- END DDP-2.0.4392
-- END DDP-2.0.4393
-- END DDP-2.0.4394
-- END DDP-2.0.4395
-- END DDP-2.0.4396
-- END DDP-2.0.4397
-- END DDP-2.0.4398
-- END DDP-2.0.4399
-- END DDP-2.0.4400
-- END DDP-2.0.4401
-- END DDP-2.0.4402
-- END DDP-2.0.4403

CREATE TABLE site_options (
  siteid SMALLINT UNSIGNED NOT NULL,
  loadvm BOOLEAN NOT NULL DEFAULT FALSE,
   PRIMARY KEY(siteid)
);
-- END DDP-2.0.4404
-- END DDP-2.0.4405
-- END DDP-2.0.4406
-- END DDP-2.0.4407
-- END DDP-2.0.4408
-- END DDP-2.0.4409
-- END DDP-2.0.4410
-- END DDP-2.0.4411
-- END DDP-2.0.4412
-- END DDP-2.0.4413
-- END DDP-2.0.4414
-- END DDP-2.0.4415
-- END DDP-2.0.4416
-- END DDP-2.0.4417
-- END DDP-2.0.4418
-- END DDP-2.0.4419
-- END DDP-2.0.4420
-- END DDP-2.0.4421
-- END DDP-2.0.4422
-- END DDP-2.0.4423
-- END DDP-2.0.4424
-- END DDP-2.0.4425
-- END DDP-2.0.4426
-- END DDP-2.0.4427
-- END DDP-2.0.4428
-- END DDP-2.0.4429
-- END DDP-2.0.4430
-- END DDP-2.0.4431
-- END DDP-2.0.4432
-- END DDP-2.0.4433
-- END DDP-2.0.4434
-- END DDP-2.0.4435
-- END DDP-2.0.4436
-- END DDP-2.0.4437
-- END DDP-2.0.4438
-- END DDP-2.0.4439
-- END DDP-2.0.4440
-- END DDP-2.0.4441
-- END DDP-2.0.4442
-- END DDP-2.0.4443
-- END DDP-2.0.4444
-- END DDP-2.0.4445
-- END DDP-2.0.4446
-- END DDP-2.0.4447
-- END DDP-2.0.4448
-- END DDP-2.0.4449
-- END DDP-2.0.4450
-- END DDP-2.0.4451
-- END DDP-2.0.4452
-- END DDP-2.0.4453
-- END DDP-2.0.4454
-- END DDP-2.0.4455
-- END DDP-2.0.4456
-- END DDP-2.0.4457
-- END DDP-2.0.4458

ALTER TABLE upgrade_history
  CHANGE status tmp_status tinyint(3) unsigned NOT NULL;

ALTER TABLE upgrade_history
  ADD COLUMN status ENUM('Success', 'Failed', 'In Progress') NOT NULL DEFAULT 'Failed' COLLATE latin1_general_cs,
  ADD COLUMN initiator varchar(10);

UPDATE upgrade_history SET status = 'Success' WHERE tmp_status = 0;

ALTER TABLE upgrade_history
  DROP COLUMN tmp_status;

-- END DDP-2.0.4459
-- END DDP-2.0.4460
-- END DDP-2.0.4461

ALTER TABLE upgrade_history
  MODIFY COLUMN initiator VARCHAR(100);

-- END DDP-2.0.4462
-- END DDP-2.0.4463
-- END DDP-2.0.4464
-- END DDP-2.0.4465
-- END DDP-2.0.4466
-- END DDP-2.0.4467
-- END DDP-2.0.4468
-- END DDP-2.0.4469
-- END DDP-2.0.4470
-- END DDP-2.0.4471
-- END DDP-2.0.4472
-- END DDP-2.0.4473
-- END DDP-2.0.4474
-- END DDP-2.0.4475
-- END DDP-2.0.4476
-- END DDP-2.0.4477
-- END DDP-2.0.4478
-- END DDP-2.0.4479
-- END DDP-2.0.4480
-- END DDP-2.0.4481
-- END DDP-2.0.4482
-- END DDP-2.0.4483
-- END DDP-2.0.4484
-- END DDP-2.0.4485
-- END DDP-2.0.4486
-- END DDP-2.0.4487
-- END DDP-2.0.4488
-- END DDP-2.0.4489
-- END DDP-2.0.4490
-- END DDP-2.0.4491
-- END DDP-2.0.4492
-- END DDP-2.0.4493
-- END DDP-2.0.4494
-- END DDP-2.0.4495
-- END DDP-2.0.4496
-- END DDP-2.0.4497
-- END DDP-2.0.4498
-- END DDP-2.0.4499
-- END DDP-2.0.4500
-- END DDP-2.0.4501
-- END DDP-2.0.4502
-- END DDP-2.0.4503
-- END DDP-2.0.4504
-- END DDP-2.0.4505
-- END DDP-2.0.4506
-- END DDP-2.0.4507
-- END DDP-2.0.4508
-- END DDP-2.0.4509
-- END DDP-2.0.4510
-- END DDP-2.0.4511
-- END DDP-2.0.4512
-- END DDP-2.0.4513
-- END DDP-2.0.4514
-- END DDP-2.0.4515
-- END DDP-2.0.4516
-- END DDP-2.0.4517
-- END DDP-2.0.4518
-- END DDP-2.0.4519
-- END DDP-2.0.4520
-- END DDP-2.0.4521
-- END DDP-2.0.4522
-- END DDP-2.0.4523
-- END DDP-2.0.4524
-- END DDP-2.0.4525
-- END DDP-2.0.4526
-- END DDP-2.0.4527
-- END DDP-2.0.4528
-- END DDP-2.0.4529
-- END DDP-2.0.4530
-- END DDP-2.0.4531
-- END DDP-2.0.4532
-- END DDP-2.0.4533
-- END DDP-2.0.4534
-- END DDP-2.0.4535
-- END DDP-2.0.4536

ALTER TABLE ddp_custom_reports
  MODIFY COLUMN site_type ENUM ('OSS','ENIQ','TOR','DDP','UNDEFINED','EO',
  'GENERIC') NOT NULL COLLATE latin1_general_cs;

-- END DDP-2.0.4538
-- END DDP-2.0.4544
-- END DDP-2.0.4545
-- END DDP-2.0.4546
-- END DDP-2.0.4547
-- END DDP-2.0.4548

ALTER TABLE ddp_certs
  MODIFY COLUMN type ENUM('httpd', 'k8s-client', 'k8master_ca', 'repl-client-repladm-ddprepl') NOT NULL;

-- END DDP-2.0.4549
-- END DDP-2.0.4550
-- END DDP-2.0.4551
-- END DDP-2.0.4552
-- END DDP-2.0.4553
-- END DDP-2.0.4554

CREATE TABLE file_processed (
    siteid    SMALLINT UNSIGNED NOT NULL,
    file_date     DATE NOT NULL,
    archive_index TINYINT UNSIGNED DEFAULT 0,
    INDEX siteDateIdx(siteid,file_date)
) PARTITION BY RANGE ( TO_DAYS(file_date) )
(
    PARTITION QMAXVALUE VALUES LESS THAN MAXVALUE
);
-- END DDP-2.0.4555
-- END DDP-2.0.4556
-- END DDP-2.0.4557
-- END DDP-2.0.4558
-- END DDP-2.0.4559
-- END DDP-2.0.4560
-- END DDP-2.0.4561
-- END DDP-2.0.4562
-- END DDP-2.0.4563
-- END DDP-2.0.4564
-- END DDP-2.0.4565
-- END DDP-2.0.4566
-- END DDP-2.0.4567
-- END DDP-2.0.4568
-- END DDP-2.0.4569
-- END DDP-2.0.4570
-- END DDP-2.0.4571
-- END DDP-2.0.4572
-- END DDP-2.0.4573
-- END DDP-2.0.4574
-- END DDP-2.0.4575
-- END DDP-2.0.4576
-- END DDP-2.0.4577
-- END DDP-2.0.4578
-- END DDP-2.0.4579
-- END DDP-2.0.4580
-- END DDP-2.0.4581
-- END DDP-2.0.4582
-- END DDP-2.0.4583
-- END DDP-2.0.4584
-- END DDP-2.0.4585
-- END DDP-2.0.4586
-- END DDP-2.0.4587
-- END DDP-2.0.4588
-- END DDP-2.0.4589
-- END DDP-2.0.4590
-- END DDP-2.0.4591
-- END DDP-2.0.4592
-- END DDP-2.0.4593
-- END DDP-2.0.4594
-- END DDP-2.0.4595
-- END DDP-2.0.4596
-- END DDP-2.0.4597
-- END DDP-2.0.4598
-- END DDP-2.0.4599
-- END DDP-2.0.4600
-- END DDP-2.0.4601
-- END DDP-2.0.4602
-- END DDP-2.0.4603
-- END DDP-2.0.4604
-- END DDP-2.0.4605
-- END DDP-2.0.4606
-- END DDP-2.0.4607
-- END DDP-2.0.4608
-- END DDP-2.0.4609
-- END DDP-2.0.4610
-- END DDP-2.0.4611
-- END DDP-2.0.4612

ALTER TABLE ddpuser_group
  MODIFY COLUMN grp ENUM ('ddpadm','accadm','usage','watchadm','cpuadm','upgrade','linkadm') NOT NULL;

CREATE TABLE ddp_links (
  id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
  siteid SMALLINT UNSIGNED NOT NULL,
  label VARCHAR(64) NOT NULL,
  link VARCHAR(256) NOT NULL,
  creator VARCHAR(30) NOT NULL,
  UNIQUE KEY k (siteid, label),
  PRIMARY KEY(id)
);

-- END DDP-2.0.4613
-- END DDP-2.0.4614
-- END DDP-2.0.4615
-- END DDP-2.0.4616
-- END DDP-2.0.4617
-- END DDP-2.0.4618
-- END DDP-2.0.4619
-- END DDP-2.0.4620
-- END DDP-2.0.4621
-- END DDP-2.0.4622
-- END DDP-2.0.4623
-- END DDP-2.0.4624
-- END DDP-2.0.4625
-- END DDP-2.0.4626
-- END DDP-2.0.4627
-- END DDP-2.0.4628
-- END DDP-2.0.4629
-- END DDP-2.0.4630
-- END DDP-2.0.4631
-- END DDP-2.0.4632
-- END DDP-2.0.4633
-- END DDP-2.0.4634
-- END DDP-2.0.4635
-- END DDP-2.0.4636
-- END DDP-2.0.4637
-- END DDP-2.0.4638
-- END DDP-2.0.4639
-- END DDP-2.0.4640
-- END DDP-2.0.4641
-- END DDP-2.0.4642
-- END DDP-2.0.4643
-- END DDP-2.0.4644
-- END DDP-2.0.4645
-- END DDP-2.0.4646
-- END DDP-2.0.4647
-- END DDP-2.0.4648
-- END DDP-2.0.4649
-- END DDP-2.0.4650
-- END DDP-2.0.4651
-- END DDP-2.0.4652

UPDATE ddpusers SET signum = LOWER(signum);
UPDATE ddpuser_group SET signum = LOWER(signum);
UPDATE ddpusers_tmp SET signum = LOWER(signum);
UPDATE ddp_custom_reports SET signum = LOWER(signum);
UPDATE ddp_alert_subscriptions SET signum = LOWER(signum);
UPDATE ddp_alert_subscriber_emails SET signum = LOWER(signum);
UPDATE ddp_report_display SET signum = LOWER(signum);

-- END DDP-2.0.4653
-- END DDP-2.0.4654
-- END DDP-2.0.4655
-- END DDP-2.0.4656
-- END DDP-2.0.4657
-- END DDP-2.0.4658
-- END DDP-2.0.4659
-- END DDP-2.0.4660
-- END DDP-2.0.4661
-- END DDP-2.0.4662
-- END DDP-2.0.4663
-- END DDP-2.0.4664
-- END DDP-2.0.4665
-- END DDP-2.0.4666
-- END DDP-2.0.4667
-- END DDP-2.0.4668
-- END DDP-2.0.4669
-- END DDP-2.0.4670
-- END DDP-2.0.4671
-- END DDP-2.0.4672
-- END DDP-2.0.4673
-- END DDP-2.0.4674
-- END DDP-2.0.4675
